<%- include('partials/header') %>
<link rel="stylesheet" href="style.css">
<main>
  <div class="container">
    
    <!-- URL Shortener Form -->
    <section class="shortener-section">
      <div class="card">
        <h2>âœ¨ Create Short URL</h2>
        
        <% if (error) { %>
          <div class="alert alert-error"><%= error %></div>
        <% } %>
        
        <% if (success) { %>
          <div class="alert alert-success"><%= success %></div>
        <% } %>

        <form action="/shorten" method="POST">
          <div class="form-group">
            <label for="originalUrl">ğŸŒ Enter your long URL</label>
            <input 
              type="text" 
              id="originalUrl" 
              name="originalUrl" 
              placeholder="https://example.com/very/long/url/that/needs/shortening" 
              required
              autocomplete="off"
            >
          </div>

          <div class="form-group">
            <label for="customCode">âœï¸ Custom short code (optional)</label>
            <input 
              type="text" 
              id="customCode" 
              name="customCode" 
              placeholder="my-awesome-link"
              pattern="[a-zA-Z0-9-_]+"
              title="Only letters, numbers, hyphens, and underscores allowed"
              autocomplete="off"
            >
            <small style="color: #64748b; font-size: 0.875rem; margin-top: 6px; display: block;">
              Leave empty for auto-generated code
            </small>
          </div>

          <button type="submit" class="btn btn-primary">
            <span>ğŸš€</span> Shorten URL
          </button>
        </form>
      </div>
    </section>

    <!-- URL Statistics -->
    <section class="stats-section">
      <h2>ğŸ“Š Your Shortened URLs</h2>
      
      <% if (urls.length === 0) { %>
        <div class="empty-state">
          <p>No URLs shortened yet. Create your first one above! ğŸ‘†</p>
        </div>
      <% } else { %>
        
        <!-- Quick Stats -->
        <div class="stats-grid">
          <div class="stat-card">
            <h3>Total Links</h3>
            <div class="stat-value"><%= urls.length %></div>
          </div>
          <div class="stat-card">
            <h3>Total Clicks</h3>
            <div class="stat-value"><%= urls.reduce((sum, url) => sum + url.clicks, 0) %></div>
          </div>
          <div class="stat-card">
            <h3>Most Popular</h3>
            <div class="stat-value">
              <%= urls.length > 0 ? Math.max(...urls.map(u => u.clicks)) : 0 %>
            </div>
          </div>
        </div>

        <!-- Links Table -->
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>ğŸ“ Original URL</th>
                <th>ğŸ”— Short URL</th>
                <th>ğŸ‘† Clicks</th>
                <th>ğŸ“… Created</th>
                <th>â° Last Accessed</th>
                <th>âš™ï¸ Actions</th>
              </tr>
            </thead>
            <tbody>
              <% urls.forEach(url => { %>
                <tr>
                  <td class="url-cell">
                    <a href="<%= url.originalUrl %>" target="_blank" rel="noopener noreferrer" title="<%= url.originalUrl %>">
                      <%= url.originalUrl.substring(0, 50) %><%= url.originalUrl.length > 50 ? '...' : '' %>
                    </a>
                  </td>
                  <td class="short-url-cell">
                    <div class="short-url-container">
                      <a href="/<%= url.shortCode %>" target="_blank" rel="noopener noreferrer">
                        <%= baseUrl %>/<%= url.shortCode %>
                      </a>
                      <button class="btn btn-copy" onclick="copyToClipboard('<%= baseUrl %>/<%= url.shortCode %>', event)">
                        ğŸ“‹ Copy
                      </button>
                    </div>
                  </td>
                  <td class="clicks-cell">
                    <span class="badge"><%= url.clicks %></span>
                  </td>
                  <td><%= new Date(url.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %></td>
                  <td>
                    <%= url.lastAccessed ? new Date(url.lastAccessed).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : 'Never' %>
                  </td>
                  <td>
                    <form action="/delete/<%= url._id %>" method="POST" style="display: inline;">
                      <button type="submit" class="btn btn-delete" onclick="return confirm('ğŸ—‘ï¸ Delete this URL?')">
                        ğŸ—‘ï¸ Delete
                      </button>
                    </form>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      <% } %>
    </section>

  </div>
</main>

<script>
  function copyToClipboard(text, event) {
    navigator.clipboard.writeText(text).then(() => {
      const btn = event.target;
      const originalText = btn.innerHTML;
      btn.innerHTML = 'âœ… Copied!';
      btn.style.background = '#d1fae5';
      btn.style.color = '#065f46';
      btn.style.borderColor = '#a7f3d0';
      setTimeout(() => {
        btn.innerHTML = originalText;
        btn.style.background = '';
        btn.style.color = '';
        btn.style.borderColor = '';
      }, 2000);
    }).catch(err => {
      alert('Failed to copy: ' + err);
    });
  }

  // Add smooth scroll behavior
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({ behavior: 'smooth' });
      }
    });
  });

  // Form validation feedback
  const form = document.querySelector('form');
  const originalUrlInput = document.getElementById('originalUrl');
  
  if (form && originalUrlInput) {
    originalUrlInput.addEventListener('input', function() {
      if (this.value && !this.value.startsWith('http://') && !this.value.startsWith('https://')) {
        this.style.borderColor = '#f59e0b';
      } else {
        this.style.borderColor = '';
      }
    });
  }
</script>

<%- include('partials/footer') %>
